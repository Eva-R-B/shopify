

{%stylesheet %}
.product-page {
        display: flex;
        gap: 40px;
        max-width: 900px;
        margin: 40px auto;
        padding: 32px;
        background: #fff;


        .product-image {
                img {
                        width: 400px;
                        height: 400px;
                        object-fit: cover;
                        border-radius: 8px;
                        background: #f7f7f7;
                        cursor: zoom-in;
                        transition: transform 0.2s ease;
                }
                
                img:hover {
                        transform: scale(1.02);
                }
        }

        .product-thumbnails {
                display: grid;
                grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
                gap: 8px;
                margin-top: 12px;
                max-width: 400px;

                .thumbnail {
                        width: 80px;
                        height: 80px;
                        object-fit: cover;
                        border-radius: 4px;
                        border: 2px solid transparent;
                        cursor: pointer;
                        transition: all 0.2s ease;
                        opacity: 0.8;
                }

                .thumbnail:hover {
                        opacity: 1;
                        transform: scale(1.05);
                }

                .thumbnail.active {
                        border-color: var(--accent-color);
                        opacity: 1;
                }
        }

        .product-details {
                flex: 1;
                display: flex;
                flex-direction: column;
                justify-content: flex-start;

                .product-title {
                        font-size: 2rem;
                        margin-bottom: 8px;
                        text-align: left;
                }

                .product-price {
                        font-size: 1.1rem;
                        margin-bottom: 16px;
                        padding:  10px 0 10px 0;
                }

                .product-form {
                        margin-bottom: 24px;

                        .product-variations,
                        .product-quantity {
                                margin-bottom: 16px;

                                label {
                                        display: block;
                                        margin-bottom: 4px;
                                        font-weight: 500;
                                }

                                select,
                                input {
                                        padding: 6px 10px;
                                        border: 1px solid #ddd;
                                        border-radius: 4px;
                                        font-size: 1rem;
                                }
                        }
                }

                .add-to-cart {
                        background: var(--accent-color);
                        color: #fff;
                        border: none;
                        padding: 12px 32px;
                        border-radius: 4px;
                        font-size: 1rem;
                        cursor: pointer;
                    }
                    .add-to-cart:hover {
                        background: var(--accent-color);
                    }

                .product-description {
                        h2 {
                                font-size: 1.2rem;
                                margin-bottom: 6px;
                        }
                        p {
                                color: #444;
                                line-height: 1.6;
                        }
                }
        }
}

@media (max-width: 800px) {
        .product-page {
                flex-direction: column;
                padding: 16px;

                .product-image {
                        img {
                                width: 100%;
                                height: auto;
                                margin-bottom: 24px;
                        }
                        
                        .product-thumbnails {
                                max-width: 100%;
                                
                                .thumbnail {
                                        width: 60px;
                                        height: 60px;
                                }
                        }
                }
        }
}

/* Related Products Section */
.related-products-section {
    max-width: 1200px;
    margin: 60px auto 40px;
    padding: 0 32px;
}

.related-products-container {
    .related-products-title {
        font-size: 2rem;
        text-align: center;
        color: var(--accent-color);
        margin-bottom: 8px;
        font-weight: 300;
    }
    
    .related-products-subtitle {
        text-align: center;
        color: #666;
        font-size: 1rem;
        margin-bottom: 2rem;
    }
    
    .related-products-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
        gap: 1.5rem;
    }
    
    .related-product-card {
        background: #fff;
        border-radius: 12px;
        overflow: hidden;
        transition: transform 0.3s ease;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
        
        &:hover {
            transform: scale(1.02);
        }
        
        a {
            text-decoration: none;
            color: inherit;
            display: block;
        }
        
        img {
            width: 100%;
            height: 200px;
            object-fit: cover;
            display: block;
        }
        
        .related-product-placeholder {
            width: 100%;
            height: 200px;
            background: #f7f7f7;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #999;
            font-size: 0.9rem;
        }
        
        .related-product-info {
            padding: 16px;
            
            h3 {
                font-size: 1.1rem;
                margin: 0 0 8px 0;
                color: #222;
                font-weight: 500;
            }
            
            .related-product-price {
                margin: 0;
                color: var(--accent-color);
                font-size: 1rem;
                font-weight: 500;
            }
        }
    }
    
    .no-related-products {
        text-align: center;
        color: #666;
        font-style: italic;
        grid-column: 1 / -1;
        padding: 2rem;
    }
}

@media (max-width: 768px) {
    .related-products-section {
        padding: 0 16px;
        margin: 40px auto 20px;
    }
    
    .related-products-container .related-products-grid {
        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
        gap: 1rem;
    }
}
{%endstylesheet %}

<!-- Product Page Layout -->
<div class="product-page">
    <div class="product-image">
        <img id="main-product-image" src="{{ product.featured_image | image_url: width:400}}" alt="Product Image">
        
        <!-- Product Thumbnails -->
        {% if product.images.size > 1 %}
            <div class="product-thumbnails">
                {% for image in product.images %}
                    <img class="thumbnail{% if forloop.first %} active{% endif %}" 
                         src="{{ image | image_url: width:160}}" 
                         alt="{{ product.title }}"
                         data-full-image="{{ image | image_url: width:800}}"
                         onclick="changeMainImage(this)">
                {% endfor %}
            </div>
        {% endif %}
    </div>
    <div class="product-details">
        {%  for block in section.blocks %}
                {% case block.type %}
                        {% when 'title' %}
                        <h1 class="product-title">{{ product.title }}</h1>
                         {% when 'price' %}
                        <div class="product-price">{{ product.price | money }}</div>
                        {% when 'description' %}
                        <div class="product-description">
                                <p>{{ product.description }}</p>
                        </div>
                       
                        {% when 'add_to_cart' %}
                        <form class="product-form" method="post" action="/cart/add">
                                <input type="hidden" name="id" value="{{ product.selected_or_first_available_variant.id }}">
                                <button type="submit" class="add-to-cart">Add to Cart</button>
                        </form>
                {% endcase %}
                {% endfor %}

    </div>
</div>

<!-- Related Products Section -->
<div class="related-products-section">
    <div class="related-products-container">
        
        {% comment %} Get products from the same category as current product {% endcomment %}
        {% assign related_products = blank %}
        {% assign current_category = blank %}
        
        {% comment %} Look for category collections in order of priority {% endcomment %}
        {% assign category_collections = 'maend-kategori,kvinde-kategori,under-1000-dkk,featured-products' | split: ',' %}
        
        {% for category_handle in category_collections %}
            {% for collection in product.collections %}
                {% if collection.handle == category_handle %}
                    {% assign current_category = collection %}
                    {% break %}
                {% endif %}
            {% endfor %}
            {% if current_category != blank %}
                {% break %}
            {% endif %}
        {% endfor %}
        
        {% if current_category != blank %}
            <h2 class="related-products-title">Similar products from {{ current_category.title }} </h2>
            
            <div class="related-products-grid">
                {% assign products_shown = 0 %}
                {% for related_product in current_category.products limit: 8 %}
                    {% unless related_product.id == product.id %}
                        {% if products_shown < 4 %}
                            <div class="related-product-card">
                                <a href="{{ related_product.url }}">
                                    {% if related_product.featured_image %}
                                        <img src="{{ related_product.featured_image | img_url: 'medium' }}" alt="{{ related_product.title }}">
                                    {% else %}
                                        <div class="related-product-placeholder">
                                            <span>No Image</span>
                                        </div>
                                    {% endif %}
                                    <div class="related-product-info">
                                        <h3>{{ related_product.title }}</h3>
                                        <p class="related-product-price">{{ related_product.price | money }}</p>
                                    </div>
                                </a>
                            </div>
                            {% assign products_shown = products_shown | plus: 1 %}
                        {% endif %}
                    {% endunless %}
                {% endfor %}
                
                {% if products_shown == 0 %}
                    <p class="no-related-products">No other products found in this category.</p>
                {% endif %}
            </div>
        {% else %}
            <p class="no-related-products">No related products available.</p>
        {% endif %}
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    console.log('Product image gallery initialized');
    
    // Make sure the function is available globally
    window.changeMainImage = function(thumbnail) {
        console.log('Thumbnail clicked');
        
        // Get the main image element
        const mainImage = document.getElementById('main-product-image');
        console.log('Main image element:', mainImage);
        
        if (!mainImage) {
            console.error('Main image element not found');
            return;
        }
        
        // Get the full-size image URL from the clicked thumbnail
        const newImageSrc = thumbnail.getAttribute('data-full-image');
        console.log('New image src:', newImageSrc);
        
        if (!newImageSrc) {
            console.error('No data-full-image attribute found');
            return;
        }
        
        // Update the main image
        mainImage.src = newImageSrc;
        
        // Update active state for thumbnails
        const thumbnails = document.querySelectorAll('.thumbnail');
        thumbnails.forEach(thumb => thumb.classList.remove('active'));
        thumbnail.classList.add('active');
        
        // Add loading state
        mainImage.style.opacity = '0.7';
        mainImage.onload = function() {
            mainImage.style.opacity = '1';
            console.log('Image loaded successfully');
        };
        
        mainImage.onerror = function() {
            console.error('Failed to load image:', newImageSrc);
            mainImage.style.opacity = '1';
        };
    };
    
    // Also add click listeners as backup
    const thumbnails = document.querySelectorAll('.thumbnail');
    thumbnails.forEach(thumbnail => {
        thumbnail.addEventListener('click', function() {
            window.changeMainImage(this);
        });
    });
});
</script>
        {% comment %} deleted this code becasue we do it with blocks instead
        <h1 class="product-title">{{ product.title }}</h1>
        <div class="product-price">{{ product.price | money }}</div> {% endcomment %}


        {% comment %} THIS IS PRODUCT VARIATIONS AND QUANTITY INPUT - was deleted temporarily
         <form class="product-form">
            {% comment %} <div class="product-variations">
                <label for="variation">Choose a {{ product.options[0] }}:</label>
                <select id="variation" name="id">{% for variant in product.variants %}<option value="{{ variant.id }}"> {{ variant.title }}</option>{% endfor %}</select>
            </div> {% endcomment %}
            {% comment %} <div class="product-quantity">
                <label for="quantity">Quantity:</label>
                <input type="number" id="quantity" name="quantity" value="1" min="1">
            </div> {% endcomment %}
        </form> {% endcomment %}

        
{% comment %} deleted this code becasue we do it with blocks instead
        {% form 'product', product %}
                <input type="hidden" name="id" value="{{ product.selected_or_first_available_variant.id }}">
                <button type="submit" class="add-to-cart">Add to Cart</button>
        {% endform %}
        <div class="product-description">
            <h2>Description</h2>
            <p>{{ product.description }}</p>
        </div> {% endcomment %}


{% schema %}
{
    "name": "Main product",
    "tag": "section",
    "blocks": [
        {
            "type": "app",
            "name": "App Block"
        },
        {
            "type": "title",
            "name": "Title",
        },
        {
            "type": "price",
            "name": "Price"
        },
        {
            "type": "description",
            "name": "Description"
        },
        {
            "type": "add_to_cart",
            "name": "Add to Cart Button"
        }
    ],
    "presets": [
        {
            "name": "Main product",
            "category": "Product",
            "blocks": [
                {
                    "type": "title",
                    "name": "Title",
                    
                },
                {
                    "type": "price",
                    "name": "Price"
                },
                {
                    "type": "description",
                    "name": "Description"
                },
                {
                    "type": "add_to_cart",
                    "name": "Add to Cart Button"
                }
            ]
        }
    ]
}
{% endschema %}